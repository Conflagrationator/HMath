<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CLaSH.Prelude.DataFlow</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_CLaSH-Prelude-DataFlow.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">clash-prelude-0.11: CAES Language for Synchronous Hardware - Prelude library</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(C) 2013-2016 University of Twente</td></tr><tr><th>License</th><td>BSD2 (see the file LICENSE)</td></tr><tr><th>Maintainer</th><td>Christiaan Baaij &lt;christiaan.baaij@gmail.com&gt;</td></tr><tr><th>Safe Haskell</th><td>Trustworthy</td></tr><tr><th>Language</th><td>Haskell2010</td></tr><tr><th>Extensions</th><td><ul class="extension-list"><li>MonoLocalBinds</li><li>ScopedTypeVariables</li><li>TypeFamilies</li><li>DataKinds</li><li>TypeSynonymInstances</li><li>FlexibleInstances</li><li>ConstrainedClassMethods</li><li>MultiParamTypeClasses</li><li>MagicHash</li><li>KindSignatures</li><li>TypeOperators</li><li>ExplicitNamespaces</li><li>ExplicitForAll</li></ul></td></tr></table><p class="caption">CLaSH.Prelude.DataFlow</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Data types</a></li><li><a href="#g:2">Creating DataFlow circuits</a></li><li><a href="#g:3">Composition combinators</a></li><li><a href="#g:4">Lock-Step operation</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Self-synchronising circuits based on data-flow principles.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:DataFlow">DataFlow</a> iEn oEn i o = <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> <a href="CLaSH-Signal-Explicit.html#t:SystemClock">SystemClock</a> iEn oEn i o</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:DataFlow-39-">DataFlow'</a> clk iEn oEn i o = <a href="#v:DF">DF</a> {<ul class="subs"><li><a href="#v:df">df</a> :: <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk i -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk iEn -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk oEn -&gt; (<a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk o, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk oEn, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk iEn)</li></ul>}</li><li class="src short"><a href="#v:liftDF">liftDF</a> :: (<a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk i -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; (<a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk o, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>)) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o</li><li class="src short"><a href="#v:pureDF">pureDF</a> :: (i -&gt; o) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o</li><li class="src short"><a href="#v:mealyDF">mealyDF</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate) =&gt; (s -&gt; i -&gt; (s, o)) -&gt; s -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o</li><li class="src short"><a href="#v:mooreDF">mooreDF</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate) =&gt; (s -&gt; i -&gt; s) -&gt; (s -&gt; o) -&gt; s -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o</li><li class="src short"><a href="#v:fifoDF">fifoDF</a> :: <span class="keyword">forall</span> addrSize m n a nm rate. (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> addrSize, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> m, (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n) ~ (2 <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-94-">^</a> addrSize), <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate) =&gt; <a href="CLaSH-Promoted-Nat.html#t:SNat">SNat</a> (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n) -&gt; <a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> m a -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a a</li><li class="src short"><a href="#v:idDF">idDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk en en a a</li><li class="src short"><a href="#v:seqDF">seqDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk bEn cEn b c -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn cEn a c</li><li class="src short"><a href="#v:firstDF">firstDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (aEn, cEn) (bEn, cEn) (a, c) (b, c)</li><li class="src short"><a href="#v:swapDF">swapDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (aEn, bEn) (bEn, aEn) (a, b) (b, a)</li><li class="src short"><a href="#v:secondDF">secondDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (cEn, aEn) (cEn, bEn) (c, a) (c, b)</li><li class="src short"><a href="#v:parDF">parDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk cEn dEn c d -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (aEn, cEn) (bEn, dEn) (a, c) (b, d)</li><li class="src short"><a href="#v:parNDF">parNDF</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n =&gt; <a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n (<a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n aEn) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n bEn) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n b)</li><li class="src short"><a href="#v:loopDF">loopDF</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> m, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> addrSize, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n) ~ (2 <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-94-">^</a> addrSize)) =&gt; <a href="CLaSH-Promoted-Nat.html#t:SNat">SNat</a> (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n) -&gt; <a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> m d -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (a, d) (b, d) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a b</li><li class="src short"><a href="#v:loopDF_nobuf">loopDF_nobuf</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (a, d) (b, d) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a b</li><li class="src short"><span class="keyword">class</span> <a href="#t:LockStep">LockStep</a> a b <span class="keyword">where</span><ul class="subs"></ul></li></ul></div><div id="interface"><h1 id="g:1">Data types</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:DataFlow" class="def">DataFlow</a> iEn oEn i o = <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> <a href="CLaSH-Signal-Explicit.html#t:SystemClock">SystemClock</a> iEn oEn i o <a href="#t:DataFlow" class="selflink">#</a></p><div class="doc"><p>Dataflow circuit synchronised to the <code><a href="CLaSH-Signal-Explicit.html#t:SystemClock">SystemClock</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:DataFlow-39-" class="def">DataFlow'</a> clk iEn oEn i o <a href="#t:DataFlow-39-" class="selflink">#</a></p><div class="doc"><p>Dataflow circuit with bidirectional synchronisation channels.</p><p>In the <em>forward</em> direction we assert <em>validity</em> of the data. In the <em>backward</em>
direction we assert that the circuit is <em>ready</em> to receive new data. A circuit
adhering to the <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> type should:</p><ul><li>Not consume data when validity is deasserted.</li><li>Only update its output when readiness is asserted.</li></ul><p>The <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a></code> type is defined as:</p><pre>newtype DataFlow' clk iEn oEn i o
  = DF
  { df :: <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk i     -- Incoming data
       -&gt; <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk iEn   -- Flagged with <em>valid</em> bits <code>iEn</code>.
       -&gt; <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk oEn   -- Incoming back-pressure, <em>ready</em> edge.
       -&gt; ( <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk o   -- Outgoing data.
          , <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk oEn -- Flagged with <em>valid</em> bits <code>oEn</code>.
          , <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk iEn -- Outgoing back-pressure, <em>ready</em> edge.
          )
  }
</pre><p>where:</p><ul><li><code>clk</code> is the clock to which the circuit is synchronised.</li><li><code>iEn</code> is the type of the bidirectional incoming synchronisation channel.</li><li><code>oEn</code> is the type of the bidirectional outgoing synchronisation channel.</li><li><code>i</code> is the incoming data type.</li><li><code>o</code> is the outgoing data type.</li></ul><p>We define several composition operators for our <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuits:</p><ul><li><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code> sequential composition.</li><li><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code> parallel composition.</li><li><code><a href="CLaSH-Prelude-DataFlow.html#v:loopDF">loopDF</a></code> add a feedback arc.</li><li><code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> proceed in lock-step.</li></ul><p>When you look at the types of the above operators it becomes clear why we
parametrise in the types of the synchronisation channels.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DF" class="def">DF</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:df" class="def">df</a> :: <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk i -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk iEn -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk oEn -&gt; (<a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk o, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk oEn, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk iEn)</dfn><div class="doc"><p>Create an ordinary circuit from a <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuit</p></div></li></ul></div></td></tr></table></div></div><h1 id="g:2">Creating DataFlow circuits</h1><div class="top"><p class="src"><a id="v:liftDF" class="def">liftDF</a> :: (<a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk i -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; (<a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk o, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>)) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o <a href="#v:liftDF" class="selflink">#</a></p><div class="doc"><p>Create a <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuit from a circuit description with the appropriate
 type:</p><pre><code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk i        -- Incoming data.
-&gt; <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk Bool  -- Flagged with a single <em>valid</em> bit.
-&gt; <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk Bool  -- Incoming back-pressure, <em>ready</em> bit.
-&gt; ( <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk o   -- Outgoing data.
   , <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk oEn -- Flagged with a single <em>valid</em> bit.
   , <code><a href="CLaSH-Signal-Internal.html#t:Signal-39-">Signal'</a></code> clk iEn -- Outgoing back-pressure, <em>ready</em> bit.
   )
</pre><p>A circuit adhering to the <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> type should:</p><ul><li>Not consume data when validity is deasserted.</li><li>Only update its output when readiness is asserted.</li></ul></div></div><div class="top"><p class="src"><a id="v:pureDF" class="def">pureDF</a> :: (i -&gt; o) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o <a href="#v:pureDF" class="selflink">#</a></p><div class="doc"><p>Create a <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuit where the given function <code>f</code> operates on the
 data, and the synchronisation channels are passed unaltered.</p></div></div><div class="top"><p class="src"><a id="v:mealyDF" class="def">mealyDF</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate) =&gt; (s -&gt; i -&gt; (s, o)) -&gt; s -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o <a href="#v:mealyDF" class="selflink">#</a></p><div class="doc"><p>Create a <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuit from a Mealy machine description as those of
 <a href="CLaSH-Prelude-Mealy.html">CLaSH.Prelude.Mealy</a></p></div></div><div class="top"><p class="src"><a id="v:mooreDF" class="def">mooreDF</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate) =&gt; (s -&gt; i -&gt; s) -&gt; (s -&gt; o) -&gt; s -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> i o <a href="#v:mooreDF" class="selflink">#</a></p><div class="doc"><p>Create a <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuit from a Moore machine description as those of
 <a href="CLaSH-Prelude-Moore.html">CLaSH.Prelude.Moore</a></p></div></div><div class="top"><p class="src"><a id="v:fifoDF" class="def">fifoDF</a> <a href="#v:fifoDF" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> addrSize, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> m, (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n) ~ (2 <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-94-">^</a> addrSize), <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="CLaSH-Promoted-Nat.html#t:SNat">SNat</a> (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n)</td><td class="doc"><p>Depth of the FIFO buffer. Must be a power of two.</p></td></tr><tr><td class="src">-&gt; <a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> m a</td><td class="doc"><p>Initial content. Can be smaller than the size of the
 FIFO. Empty spaces are initialised with <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Prelude.html#v:undefined">undefined</a></code>.</p></td></tr><tr><td class="src">-&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a FIFO buffer adhering to the <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> protocol. Can be filled
 with initial content.</p><p>To create a FIFO of size 4, with two initial values 2 and 3 you would write:</p><pre>fifo4 = <code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code> d4 (2 :&gt; 3 :&gt; Nil)
</pre></div></div><h1 id="g:3">Composition combinators</h1><div class="top"><p class="src"><a id="v:idDF" class="def">idDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk en en a a <a href="#v:idDF" class="selflink">#</a></p><div class="doc"><p>Identity circuit</p><p><img src="doc/idDF.svg" /></p></div></div><div class="top"><p class="src"><a id="v:seqDF" class="def">seqDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk bEn cEn b c -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn cEn a c <a href="#v:seqDF" class="selflink">#</a></p><div class="doc"><p>Sequential composition of two <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuits.</p><p><img src="doc/seqDF.svg" /></p></div></div><div class="top"><p class="src"><a id="v:firstDF" class="def">firstDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (aEn, cEn) (bEn, cEn) (a, c) (b, c) <a href="#v:firstDF" class="selflink">#</a></p><div class="doc"><p>Apply the circuit to the first halve of the communication channels, leave
 the second halve unchanged.</p><p><img src="doc/firstDF.svg" /></p></div></div><div class="top"><p class="src"><a id="v:swapDF" class="def">swapDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (aEn, bEn) (bEn, aEn) (a, b) (b, a) <a href="#v:swapDF" class="selflink">#</a></p><div class="doc"><p>Swap the two communication channels.</p><p><img src="doc/swapDF.svg" /></p></div></div><div class="top"><p class="src"><a id="v:secondDF" class="def">secondDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (cEn, aEn) (cEn, bEn) (c, a) (c, b) <a href="#v:secondDF" class="selflink">#</a></p><div class="doc"><p>Apply the circuit to the second halve of the communication channels, leave
 the first halve unchanged.</p><p><img src="doc/secondDF.svg" /></p></div></div><div class="top"><p class="src"><a id="v:parDF" class="def">parDF</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk cEn dEn c d -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (aEn, cEn) (bEn, dEn) (a, c) (b, d) <a href="#v:parDF" class="selflink">#</a></p><div class="doc"><p>Compose two <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuits in parallel.</p><p><img src="doc/parDF.svg" /></p></div></div><div class="top"><p class="src"><a id="v:parNDF" class="def">parNDF</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n =&gt; <a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n (<a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk aEn bEn a b) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n aEn) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n bEn) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n b) <a href="#v:parNDF" class="selflink">#</a></p><div class="doc"><p>Compose <em>n</em> <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> circuits in parallel.</p></div></div><div class="top"><p class="src"><a id="v:loopDF" class="def">loopDF</a> <a href="#v:loopDF" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> m, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> addrSize, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> rate, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownSymbol">KnownSymbol</a> nm, (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n) ~ (2 <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-94-">^</a> addrSize))</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="CLaSH-Promoted-Nat.html#t:SNat">SNat</a> (m <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:-43-">+</a> n)</td><td class="doc"><p>Depth of the FIFO buffer. Must be a power of two</p></td></tr><tr><td class="src">-&gt; <a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> m d</td><td class="doc"><p>Initial content of the FIFO buffer. Can be smaller than
 the size of the FIFO. Empty spaces are initialised with
 <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Prelude.html#v:undefined">undefined</a></code>.</p></td></tr><tr><td class="src">-&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (a, d) (b, d)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> (<a href="CLaSH-Signal-Internal.html#v:Clk">Clk</a> nm rate) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a b</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Feed back the second halve of the communication channel. The feedback loop
 is buffered by a <code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code> circuit.</p><p>So given a circuit <em>h</em> with two synchronisation channels:</p><pre><strong>h</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> (Bool,Bool) (Bool,Bool) (a,d) (b,d)
</pre><p>Feeding back the <em>d</em> part (including its synchronisation channels) results
 in:</p><pre><code><a href="CLaSH-Prelude-DataFlow.html#v:loopDF">loopDF</a></code> d4 Nil h
</pre><p><img src="doc/loopDF.svg" /></p><p>When you have a circuit <code>h'</code>, with only a single synchronisation channel:</p><pre><strong>h'</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool (a,d) (b,d)
</pre><p>and you want to compose <em>h'</em> in a feedback loop, the following will not work:</p><pre>f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` (<code><a href="CLaSH-Prelude-DataFlow.html#v:loopDF">loopDF</a></code> d4 Nil h') `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` g
</pre><p>The circuits <code>f</code>, <code>h</code>, and <code>g</code>, must operate in <em>lock-step</em> because the <em>h'</em>
 circuit only has a single synchronisation channel. Consequently, there
 should only be progress when all three circuits are producing <em>valid</em> data
 and all three circuits are <em>ready</em> to receive new data. We need to compose
 <em>h'</em> with the <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> and <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> functions to achieve the <em>lock-step</em>
 operation.</p><pre>f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` (<code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:loopDF">loopDF</a></code> d4 Nil h' `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code>) `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` g
</pre><p><img src="doc/loopDF_sync.svg" /></p></div></div><div class="top"><p class="src"><a id="v:loopDF_nobuf" class="def">loopDF_nobuf</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a>) (a, d) (b, d) -&gt; <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a b <a href="#v:loopDF_nobuf" class="selflink">#</a></p><div class="doc"><p>Feed back the second halve of the communication channel. Unlike <code><a href="CLaSH-Prelude-DataFlow.html#v:loopDF">loopDF</a></code>,
 the feedback loop is <em>not</em> buffered.</p></div></div><h1 id="g:4">Lock-Step operation</h1><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:LockStep" class="def">LockStep</a> a b <span class="keyword">where</span> <a href="#t:LockStep" class="selflink">#</a></p><div class="doc"><p>Reduce or extend the synchronisation granularity of parallel compositions.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a>, <a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:lockStep" class="def">lockStep</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk a <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> b b <a href="#v:lockStep" class="selflink">#</a></p><div class="doc"><p>Reduce the synchronisation granularity to a single <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></code>ean value.</p><p>Given:</p><pre><strong>f</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool a b
<strong>g</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool c d
<strong>h</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool (b,d) (p,q)
</pre><p>We <em>cannot</em> simply write:</p><pre>(f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g) `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` h
</pre><p>because, <code>f `parDF` g</code>, has type, <code><code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> (Bool,Bool) (Bool,Bool) (a,c) (b,d)</code>,
 which does not match the expected synchronisation granularity of <code>h</code>. We
 need a circuit in between that has the type:</p><pre><code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> (Bool,Bool) Bool (b,d) (b,d)
</pre><p>Simply <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#v:-38--38-">&amp;&amp;</a></code>-ing the <em>valid</em> signals in the forward direction, and
 duplicating the <em>ready</em> signal in the backward direction is however not
 enough. We also need to make sure that <code>f</code> does not update its output when
 <code>g</code>'s output is invalid and visa versa, as <code>h</code> can only consume its input
 when both <code>f</code> and <code>g</code> are producing valid data. <code>g</code>'s <em>ready</em> port is hence
 only asserted when <code>h</code> is ready and <code>f</code> is producing <em>valid</em> data. And <code>f</code>'s
 ready port is only asserted when <code>h</code> is ready and <code>g</code> is producing valid
 data. <code>f</code> and <code>g</code> will hence be proceeding in <em>lock-step</em>.</p><p>The <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> function ensures that all synchronisation signals are
 properly connected:</p><pre>(f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g) `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` h
</pre><p><img src="doc/lockStep.svg" /></p><p><strong>Note 1</strong>: ensure that the components that you are synchronising have
 buffered/delayed <code>ready</code> and <code>valid</code> signals, or <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> has the
 potential to introduce combinational loops. You can do this by placing
 <code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code>s on the parallel channels. Extending the above example, you would
 write:</p><pre>((f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code> d4 Nil) `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` (g `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code> d4 Nil)) `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` h
</pre><p><strong>Note 2</strong>: <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> works for arbitrarily nested tuples. That is:</p><pre>p :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool ((b,d),d) z

q :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> ((Bool,Bool),Bool) ((Bool,Bool),Bool) ((a,c),c) ((b,d),d)
q = f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g

r = q `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:lockStep">lockStep</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` p
</pre><p>Does the right thing.</p></div><p class="src"><a id="v:stepLock" class="def">stepLock</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> a b b <a href="#v:stepLock" class="selflink">#</a></p><div class="doc"><p>Extend the synchronisation granularity from a single <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></code>ean value.</p><p>Given:</p><pre><strong>f</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool a b
<strong>g</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool c d
<strong>h</strong> :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool (p,q) (a,c)
</pre><p>We <em>cannot</em> simply write:</p><pre>h `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` (f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g)
</pre><p>because, <code>f `parDF` g</code>, has type, <code><code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> (Bool,Bool) (Bool,Bool) (a,c) (b,d)</code>,
 which does not match the expected synchronisation granularity of <code>h</code>. We
 need a circuit in between that has the type:</p><pre><code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool (Bool,Bool) (a,c) (a,c)
</pre><p>Simply <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#v:-38--38-">&amp;&amp;</a></code>-ing the <em>ready</em> signals in the backward direction, and
 duplicating the <em>valid</em> signal in the forward direction is however not
 enough. We need to make sure that <code>f</code> does not consume values when <code>g</code> is
 not <em>ready</em> and visa versa, because <code>h</code> cannot update the values of its
 output tuple independently. <code>f</code>'s <em>valid</em> port is hence only asserted when
 <code>h</code> is valid and <code>g</code> is ready to receive new values. <code>g</code>'s <em>valid</em> port is
 only asserted when <code>h</code> is valid and <code>f</code> is ready to receive new values.
 <code>f</code> and <code>g</code> will hence be proceeding in <em>lock-step</em>.</p><p>The <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> function ensures that all synchronisation signals are
 properly connected:</p><pre>h `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` (f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g)
</pre><p><img src="doc/stepLock.svg" /></p><p><strong>Note 1</strong>: ensure that the components that you are synchronising have
 buffered/delayed <code>ready</code> and <code>valid</code> signals, or <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> has the
 potential to introduce combinational loops. You can do this by placing
 <code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code>s on the parallel channels. Extending the above example, you would
 write:</p><pre>h `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` ((<code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code> d4 Nil `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` f) `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` (<code><a href="CLaSH-Prelude-DataFlow.html#v:fifoDF">fifoDF</a></code> d4 Nil `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` g))
</pre><p><strong>Note 2</strong>: <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> works for arbitrarily nested tuples. That is:</p><pre>p :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> Bool Bool z ((a,c),c)

q :: <code><a href="CLaSH-Prelude-DataFlow.html#t:DataFlow">DataFlow</a></code> ((Bool,Bool),Bool) ((Bool,Bool),Bool) ((a,c),c) ((b,d),d)
q = f `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:parDF">parDF</a></code></code>` g

r = p `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` <code><a href="CLaSH-Prelude-DataFlow.html#v:stepLock">stepLock</a></code> `<code><code><a href="CLaSH-Prelude-DataFlow.html#v:seqDF">seqDF</a></code></code>` q
</pre><p>Does the right thing.</p></div></div><div class="subs instances"><p id="control.i:LockStep" class="caption collapser" onclick="toggleSection('i:LockStep')">Instances</p><div id="section.i:LockStep" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:LockStep:LockStep:1" class="instance expander" onclick="toggleSection('i:ic:LockStep:LockStep:1')"></span> <a href="CLaSH-Prelude-DataFlow.html#t:LockStep">LockStep</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> c</span> <a href="#t:LockStep" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:LockStep:LockStep:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:lockStep">lockStep</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> c c <a href="#v:lockStep" class="selflink">#</a></p><p class="src"><a href="#v:stepLock">stepLock</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> c c <a href="#v:stepLock" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:LockStep:LockStep:2" class="instance expander" onclick="toggleSection('i:ic:LockStep:LockStep:2')"></span> (<a href="CLaSH-Prelude-DataFlow.html#t:LockStep">LockStep</a> a x, <a href="CLaSH-Prelude-DataFlow.html#t:LockStep">LockStep</a> b y) =&gt; <a href="CLaSH-Prelude-DataFlow.html#t:LockStep">LockStep</a> (a, b) (x, y)</span> <a href="#t:LockStep" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:LockStep:LockStep:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:lockStep">lockStep</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (a, b) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> (x, y) (x, y) <a href="#v:lockStep" class="selflink">#</a></p><p class="src"><a href="#v:stepLock">stepLock</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> (a, b) (x, y) (x, y) <a href="#v:stepLock" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:LockStep:LockStep:3" class="instance expander" onclick="toggleSection('i:ic:LockStep:LockStep:3')"></span> (<a href="CLaSH-Prelude-DataFlow.html#t:LockStep">LockStep</a> en a, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/GHC-TypeLits.html#t:KnownNat">KnownNat</a> n) =&gt; <a href="CLaSH-Prelude-DataFlow.html#t:LockStep">LockStep</a> (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n en) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a)</span> <a href="#t:LockStep" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:LockStep:LockStep:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:lockStep">lockStep</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n en) <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a) <a href="#v:lockStep" class="selflink">#</a></p><p class="src"><a href="#v:stepLock">stepLock</a> :: <a href="CLaSH-Prelude-DataFlow.html#t:DataFlow-39-">DataFlow'</a> clk <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n en) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a) (<a href="CLaSH-Sized-Vector.html#t:Vec">Vec</a> n a) <a href="#v:stepLock" class="selflink">#</a></p></div></div></td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>